name: Install dda Action
description: Install and configure dda
branding:
  icon: download-cloud
  color: purple

inputs:
  version:
    description: The version of dda to install
    default: latest
  features:
    description: Space-separated list of features to install
    default: ""

runs:
  using: composite
  steps:
  - name: Install and configure dda
    run: |
      set -eo pipefail
      script="'${{ github.action_path }}${{ runner.os == 'Windows' && '\\' || '/' }}main.sh'"
      max_attempts=3
      attempt=1
      until eval "$script"; do
        status=$?
        if [ $attempt -ge $max_attempts ]; then
          echo "Failed after $attempt attempts (exit $status)"
          exit $status
        fi
        echo "Attempt $attempt failed (exit $status). Retrying in $((attempt*5))s..."
        sleep $((attempt*5))
        attempt=$((attempt+1))
      done
    shell: bash
    env:
      DDA_INSTALL_VERSION: "${{ inputs.version }}"
      DDA_INSTALL_FEATURES: "${{ inputs.features }}"
